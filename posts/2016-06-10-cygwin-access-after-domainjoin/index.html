<!doctype html><html lang=en-us><head><title>ssh to Cygwin fails after Computer joins domain // Chris Neales Blog</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.105.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="John Doe"><meta name=description content><link rel=stylesheet href=/css/main.min.0fb49e70a30412f97ddfc418e18fefef1d9fcdebe45f634dbbba768b00fe1eec.css><meta name=twitter:card content="summary"><meta name=twitter:title content="ssh to Cygwin fails after Computer joins domain"><meta name=twitter:description content="I was asked to look into an issue where ssh connections to a windows server running cygwin had started to fail after the computer joined an AD domain.
The user was running the scripts under a user local to that computer. They needed to use that to run scripts with the same user before AND after it joined the domain.
I checked the usual, updated a GPO to disable &ldquo;Deny access to this computer from the network&rdquo;."><meta property="og:title" content="ssh to Cygwin fails after Computer joins domain"><meta property="og:description" content="I was asked to look into an issue where ssh connections to a windows server running cygwin had started to fail after the computer joined an AD domain.
The user was running the scripts under a user local to that computer. They needed to use that to run scripts with the same user before AND after it joined the domain.
I checked the usual, updated a GPO to disable &ldquo;Deny access to this computer from the network&rdquo;."><meta property="og:type" content="article"><meta property="og:url" content="https://www.chrisneale.org/posts/2016-06-10-cygwin-access-after-domainjoin/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-06-10T22:00:00+00:00"><meta property="article:modified_time" content="2016-06-10T22:00:00+00:00"></head><body><header class=app-header><a href=https://www.chrisneale.org/><img class=app-header-avatar src=/images/avatar.jpg alt="John Doe"></a>
<span class=app-header-title>Chris Neales Blog</span><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>ssh to Cygwin fails after Computer joins domain</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Jun 10, 2016</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>2 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://www.chrisneale.org/tags/ssh/>ssh</a>
<a class=tag href=https://www.chrisneale.org/tags/windows/>Windows</a>
<a class=tag href=https://www.chrisneale.org/tags/linux/>Linux</a>
<a class=tag href=https://www.chrisneale.org/tags/cygwin/>cygwin</a></div></div></header><div class=post-content><p>I was asked to look into an issue where ssh connections to a windows server running cygwin had started to fail after the computer joined an AD domain.</p><p>The user was running the scripts under a user local to that computer. They needed to use that to run scripts with the same user before AND after it joined the domain.</p><p>I checked the usual, updated a GPO to disable &ldquo;Deny access to this computer from the network&rdquo;. Still no joy.
After joining the domain I could SSH in as a Domain User, but not the local user any more.</p><p>In checking the event logs I noticed that the Security Event Log was registering that when the local user tried to log in it showed as NOUSER.
After reading up on Cygwin some more I found that once a Computer is joined to a domain it uses that for it&rsquo;s default Account Database. To allow
Cygwin to be able to search and match local user accounts it was necessary for it to have a copy of the local SAM DB dumped.
So I opened a Cygwin session and ran<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>mkpasswd <span style=color:#f92672>-</span>l <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>/etc/</span>passwd</span></span></code></pre></div></p><p>As soon as I had run that I could log in using COMPUTERNAME+localusername as my login.
The reason I needed to do that is that the passwd file generated AFTER joining the domain tags the hostname on to users.
I tested on a non-domain joined computer and that just added the users as localusername.</p><p>So my tip is<br><strong>Before joining a domain run the mkpasswd step above then you will be able to continue running scripts (presuming no other GPOs lock down your computer and prevent it!)</strong><br>Why weren&rsquo;t they using WinRM? Don&rsquo;t ask :-(</p></div><div class=post-footer></div></article></main></body></html>