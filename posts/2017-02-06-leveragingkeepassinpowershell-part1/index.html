<!doctype html><html lang=en-us><head><title>Leveraging Keepass via Powershell to Keep Passwords Out of Scripts // Chris Neales Blog</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.105.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="John Doe"><meta name=description content><link rel=stylesheet href=https://www.chrisneale.org/css/main.min.0fb49e70a30412f97ddfc418e18fefef1d9fcdebe45f634dbbba768b00fe1eec.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Leveraging Keepass via Powershell to Keep Passwords Out of Scripts"><meta name=twitter:description content="Passwords visible in scripts&mldr;.just say that out loud. If that doesn&rsquo;t make you itch with a compelling urge to take the author to one side and have seriously stern words with them, then feel free to move on to the next blog&mldr;.but you&rsquo;re a bad person!
It&rsquo;s something no-one should have to see, but sometimes, for brevity it happens. Someone hard codes a password in a script/program &ldquo;just to test&rdquo;. Well it&rsquo;s a bad habit to get in to."><meta property="og:title" content="Leveraging Keepass via Powershell to Keep Passwords Out of Scripts"><meta property="og:description" content="Passwords visible in scripts&mldr;.just say that out loud. If that doesn&rsquo;t make you itch with a compelling urge to take the author to one side and have seriously stern words with them, then feel free to move on to the next blog&mldr;.but you&rsquo;re a bad person!
It&rsquo;s something no-one should have to see, but sometimes, for brevity it happens. Someone hard codes a password in a script/program &ldquo;just to test&rdquo;. Well it&rsquo;s a bad habit to get in to."><meta property="og:type" content="article"><meta property="og:url" content="https://www.chrisneale.org/posts/2017-02-06-leveragingkeepassinpowershell-part1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-02-06T22:00:00+00:00"><meta property="article:modified_time" content="2017-02-06T22:00:00+00:00"></head><body><header class=app-header><a href=https://www.chrisneale.org/><img class=app-header-avatar src=/avatar.jpg alt="John Doe"></a>
<span class=app-header-title>Chris Neales Blog</span><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Leveraging Keepass via Powershell to Keep Passwords Out of Scripts</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Feb 6, 2017</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>2 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://www.chrisneale.org/tags/powershell/>PowerShell</a>
<a class=tag href=https://www.chrisneale.org/tags/security/>Security</a>
<a class=tag href=https://www.chrisneale.org/tags/scripting/>Scripting</a></div></div></header><div class=post-content><p>Passwords visible in scripts&mldr;.just say that out loud. If that doesn&rsquo;t make you itch with a compelling urge to take the author to one side and have seriously stern words with them, then feel free to move on to the next blog&mldr;.but you&rsquo;re a bad person!</p><p>It&rsquo;s something no-one should have to see, but sometimes, for brevity it happens. Someone hard codes a password in a script/program &ldquo;just to test&rdquo;. Well it&rsquo;s a bad habit to get in to. But I&rsquo;m not here to bring you problems, here&rsquo;s a solution.<br>I use KeePass and I constantly find cool new features. Like the paste to type, where it actually types in the username, tabs to the next entry field and types the password. This alone has saved me hours of my life and much frustration.</p><p>So I was even more impressed when I found you could make powershell calls to KeePass with a relative minimum of fuss and could use this feature to create KeePass password DBs from scratch or to read in existing ones to utilise for an script/activity.</p><p>Let&rsquo;s get stuck in.
First you need the Keepass installable version installed where you are running your script (or at least a copy of the installed files exe&rsquo;s and dll&rsquo;s).<br>Now let&rsquo;s Load the .net binaries in<br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>PS</span> <span style=color:#e6db74>C</span>:\temp\<span style=color:#66d9ef>KeePass</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>.</span><span style=color:#ae81ff>31</span><span style=color:#f92672>&gt;</span> (<span style=color:#66d9ef>Get</span><span style=color:#f92672>-</span><span style=color:#66d9ef>ChildItem</span> <span style=color:#f92672>-</span>recurse $script<span style=color:#e6db74>:myinvocation</span><span style=color:#f92672>.</span>mycommand<span style=color:#f92672>.</span>path <span style=color:#f92672>|</span> <span style=color:#66d9ef>Where</span><span style=color:#f92672>-</span><span style=color:#66d9ef>Object</span> {($_<span style=color:#f92672>.</span>Extension <span style=color:#f92672>-</span><span style=color:#66d9ef>EQ</span> <span style=color:#e6db74>&#34;.dll&#34;</span>) <span style=color:#f92672>-</span><span style=color:#f92672>or</span> ($_<span style=color:#f92672>.</span>Extension <span style=color:#f92672>-</span>eq <span style=color:#e6db74>&#34;.exe&#34;</span>)} <span style=color:#f92672>|</span> <span style=color:#66d9ef>ForEach</span><span style=color:#f92672>-</span><span style=color:#66d9ef>Object</span> { $AssemblyName<span style=color:#f92672>=</span>$_<span style=color:#f92672>.</span>FullName; <span style=color:#66d9ef>Try</span> {<span style=color:#f92672>[</span><span style=color:#66d9ef>Reflection</span><span style=color:#f92672>.</span>Assembly<span style=color:#f92672>]::</span><span style=color:#66d9ef>LoadFile</span>($AssemblyName) } <span style=color:#66d9ef>Catch</span>{ }} ) <span style=color:#f92672>|</span> out<span style=color:#f92672>-</span>null
</span></span><span style=display:flex><span><span style=color:#66d9ef>PS</span> <span style=color:#e6db74>C</span>:\temp\<span style=color:#66d9ef>KeePass</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>.</span><span style=color:#ae81ff>31</span><span style=color:#f92672>&gt;</span></span></span></code></pre></div>Now they are loaded let&rsquo;s test we can create a new KeePass object (an object not a kp database on disk. The object is just a construct/pointer to an in-memory KP Database object), so try<br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>$MyKPDatabase <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span><span style=color:#f92672>-</span>object <span style=color:#66d9ef>KeePassLib</span><span style=color:#f92672>.</span>PwDatabase  
</span></span><span style=display:flex><span>$MyKPDatabase  </span></span></code></pre></div></p></div><div class=post-footer></div></article></main></body></html>