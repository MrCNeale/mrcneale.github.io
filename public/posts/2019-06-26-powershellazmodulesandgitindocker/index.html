<!doctype html>
<html lang="en-us">
  <head>
    <title>Build a Docker container with a standard deployment environment // Chris Neales Blog</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.105.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://www.chrisneale.org/css/main.min.0fb49e70a30412f97ddfc418e18fefef1d9fcdebe45f634dbbba768b00fe1eec.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Build a Docker container with a standard deployment environment"/>
<meta name="twitter:description" content="Practical user for Docker/Containers in infra as code (IaC) - a standard deployment environment &ldquo;Infrastructure as Code, Automate all the things, Containers are the future, DevOPs to the max!&rdquo; has been a chorus of lots of people in tech for a while and as a non-app dev I never really saw applications for containers to help what I do.
What do you do? Good question. Well it involves a lot of ARM template deployments and deploying blueprints and standard environments to run tests against."/>

    <meta property="og:title" content="Build a Docker container with a standard deployment environment" />
<meta property="og:description" content="Practical user for Docker/Containers in infra as code (IaC) - a standard deployment environment &ldquo;Infrastructure as Code, Automate all the things, Containers are the future, DevOPs to the max!&rdquo; has been a chorus of lots of people in tech for a while and as a non-app dev I never really saw applications for containers to help what I do.
What do you do? Good question. Well it involves a lot of ARM template deployments and deploying blueprints and standard environments to run tests against." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.chrisneale.org/posts/2019-06-26-powershellazmodulesandgitindocker/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-26T22:00:00+00:00" />
<meta property="article:modified_time" content="2019-06-26T22:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://www.chrisneale.org/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <span class="app-header-title">Chris Neales Blog</span>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Build a Docker container with a standard deployment environment</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jun 26, 2019
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://www.chrisneale.org/tags/arm/">ARM</a>
              <a class="tag" href="https://www.chrisneale.org/tags/template/">Template</a>
              <a class="tag" href="https://www.chrisneale.org/tags/troubleshooting/">Troubleshooting</a>
              <a class="tag" href="https://www.chrisneale.org/tags/azure/">Azure</a>
              <a class="tag" href="https://www.chrisneale.org/tags/extensions/">Extensions</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <img src="/images/azdocker.png">   
<h1 id="practical-user-for-dockercontainers-in-infra-as-code-iac---a-standard-deployment-environment">Practical user for Docker/Containers in infra as code (IaC) - a standard deployment environment</h1>
<p>&ldquo;Infrastructure as Code, Automate all the things, Containers are the future, DevOPs to the max!&rdquo; has been a chorus of lots of people in tech for a while and as a non-app dev I never really saw applications for containers to help what I do.<br>
What do you do? Good question. Well it involves a lot of ARM template deployments and deploying blueprints and standard environments to run tests against.</p>
<p>Other folks need to do that and quite often we come up against the &ldquo;it doesn&rsquo;t work on my PC/MacbookPro!&rdquo;.<br>
When I heard that I remembered all the Docker/Container talks I&rsquo;d been to that used that as an example or use case for Docker. A standard env no matter where you run it.</p>
<p>So to standardise being able to deploy ARM templates, from a github repo I decided to create a Docker Image, based on CentOS, that has Powershell Core, AZ cmdlets and Git installed. Simples!</p>
<p>Below is how I did it and how you can too (instructions for windows, but the theory&rsquo;s the same for mac/linux).<br>
NOTE: Before you start go to <a href="https://hub.docker.com/">https://hub.docker.com/</a> and sign up for an account to be able to store your image publicly in later. My repo is called &ldquo;pobx&rdquo;&hellip;don&rsquo;t ask&hellip;.</p>
<p>1 Install docker for windows/mac/linux<br>
<a href="https://docs.docker.com/docker-for-windows/install/">https://docs.docker.com/docker-for-windows/install/</a><br>
It&rsquo;s a next next finish and reboot if required.<br>
2 Launch Docker Desktop and then get the centos base image by opening powershell and run</p>
<pre tabindex="0"><code>docker pull centos
</code></pre><p>3 Start a container from the CentOS image so we can modify it and create a new image. We need to do this in <em>interactive</em> mode so we can run commands after each other and see the results.</p>
<pre tabindex="0"><code>docker run -it centos /bin/bash
</code></pre><p>Then install the things</p>
<pre tabindex="0"><code>yum install -y git
curl https://packages.microsoft.com/config/rhel/7/prod.repo | tee /etc/yum.repos.d/microsoft.repo
yum install -y powershell
pwsh
install-module az -force
exit  
exit  
</code></pre><p><img src="/images/installs1.png"><img src="/images/installs2.png"><img src="/images/installs3.png"><br>
What you have now is a CentOS containers, with Powershell and AZ Modules and Git Installed fresh.<br>
4 Now find the container (it&rsquo;s still running even though you exited bash) and it&rsquo;s amusing two word underscore separated name by running:</p>
<pre tabindex="0"><code>docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES
90194f94db40        centos              &#34;/bin/bash&#34;         26 minutes ago      Exited (0) 6 minutes ago                       nifty_pike
</code></pre><p>5 Now we want to create the image of that container locally, but the local repo name we use should be the same as our Docker Hub repo we created before we started. In my case &ldquo;pobx&rdquo;</p>
<pre tabindex="0"><code>docker commit nifty_pike pobx/centos_az_ps_git_blog:v1
sha256:912b4df6971e8b4b872e26d27bfb92df60b7c4756b63e02964c131102418ecdb
</code></pre><p>6 Now push it to docker hub, like this</p>
<pre tabindex="0"><code>docker push pobx/centos_az_ps_git_blog:v1
The push refers to repository [docker.io/pobx/centos_az_ps_git_blog]
260dddc15255: Pushed
d69483a6face: Mounted from pobx/centos_ps_az_git
v1: digest: sha256:2801d29dd86a7eb2c8fceb72442b42f4473d2ea80965e256c9aabfb9ed31a1d9 size: 742
</code></pre><p>And you can see it in docker hub, which means anyone can pull it down.
<img src="/images/dockerhub.png"><br>
7 Done. Now it&rsquo;s in docker hub.  Go to another pc and run</p>
<pre tabindex="0"><code>docker pull myRepo/centos_az_ps_git:v1
docker run -it myRepo/centos_az_ps_git:v1 pwsh
</code></pre><p>Et voila<br>
<img src="/images/connected.png"><br>
Yes I get this is powershell inside powershell, but you could run it from a linux vm with no powershell core, or mac or windows without git commands or a windows machine with old AzureRM modules or no Azure modules.<br>
If you tested your templates and/or scripts run from this container, it will work when run on the other person&rsquo;s machine from this container too.</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
