<!doctype html>
<html lang="en-us">
  <head>
    <title>Time waits for no man, or member server - The Importance of Time Synchronisation in Windows 2008 Domains // Chris Neales Blog</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.105.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://www.chrisneale.org/css/main.min.0fb49e70a30412f97ddfc418e18fefef1d9fcdebe45f634dbbba768b00fe1eec.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Time waits for no man, or member server - The Importance of Time Synchronisation in Windows 2008 Domains"/>
<meta name="twitter:description" content="I had built a Windows 2008 server from a custom SOE disc, all seemed well but it wouldn&rsquo;t register in DNS. I&rsquo;d specified the name servers correctly and the server I&rsquo;d built the week before had no issues registering in the same domain. This was a relatively new domain however and the server was pinging all the same and joined the domain without issue. I continued&hellip;but then spotted that the SOE post build tasks had failed on Activating Windows."/>

    <meta property="og:title" content="Time waits for no man, or member server - The Importance of Time Synchronisation in Windows 2008 Domains" />
<meta property="og:description" content="I had built a Windows 2008 server from a custom SOE disc, all seemed well but it wouldn&rsquo;t register in DNS. I&rsquo;d specified the name servers correctly and the server I&rsquo;d built the week before had no issues registering in the same domain. This was a relatively new domain however and the server was pinging all the same and joined the domain without issue. I continued&hellip;but then spotted that the SOE post build tasks had failed on Activating Windows." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.chrisneale.org/posts/2012-05-30-time-waits-for-no-man-or-member-server-the-importance-of-time-synchronisation/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-05-30T18:00:00+00:00" />
<meta property="article:modified_time" content="2012-05-30T18:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://www.chrisneale.org/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <span class="app-header-title">Chris Neales Blog</span>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Time waits for no man, or member server - The Importance of Time Synchronisation in Windows 2008 Domains</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          May 30, 2012
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://www.chrisneale.org/tags/2008/">2008</a>
              <a class="tag" href="https://www.chrisneale.org/tags/activation/">activation</a>
              <a class="tag" href="https://www.chrisneale.org/tags/dns/">dns</a>
              <a class="tag" href="https://www.chrisneale.org/tags/kms/">kms</a>
              <a class="tag" href="https://www.chrisneale.org/tags/ntp/">ntp</a>
              <a class="tag" href="https://www.chrisneale.org/tags/slmgr/">slmgr</a>
              <a class="tag" href="https://www.chrisneale.org/tags/windows/">Windows</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <!-- raw HTML omitted -->
<p>I had built a Windows 2008 server from a custom SOE disc, all seemed well but it wouldn&rsquo;t register in DNS.  I&rsquo;d specified the name servers correctly and the server I&rsquo;d built the week before had no issues registering in the same domain.  This was a relatively new domain however and the server was pinging all the same and joined the domain without issue.  I continued&hellip;but then spotted that the SOE post build tasks had failed on Activating Windows.</p>
<p>I popped in to server manager to run the activation manually&hellip;..no joy.  It prompted me for a product key and seemed to have lost the product key it originally had.  The domain had a KMS server so I decided to try and activate using the command line script <!-- raw HTML omitted -->slmgr.vbs <!-- raw HTML omitted -->for updating/edit KMS configuration on clients and for activating clients.  I&rsquo;ve added links to the syntax below and most usefully a list of the Microsoft Product Keys, which is not easily googleable, so one to stick in your bookmarks.</p>
<p>The vbs script kept erroring and complaining that activation failed.  However when RDP-ing to the KMS server itself and running</p>
<p><!-- raw HTML omitted -->cscript slmgr.vbs /dlv<!-- raw HTML omitted --></p>
<p>To get the detailed license server information I could see that every time I tried to activate the client (in this case a member server) that both the attempted activations and failed activations counts increased.</p>
<p>So I knew that KMS was functioning and that the communications were working ok between the two.  I went into the member servers event log (when in doubt RTFM type moment) and before I found any license/activation errors I spotted a Time service error.  It was a familiar one to most complaining that the server was more than 5000ms out from it&rsquo;s time source, e.g. the DC.  That&rsquo;s when it all clicked I did remember having to reset the clock on the build last week and having not done this (I claim Friday as my defence) the KMS server was refusing to activate the Windows Product due to the time difference.</p>
<p>Now this wasn&rsquo;t the error message given by slmgr.vbs or in the event log.  However there is an error code that might have been more useful</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->w32tm /config /syncfromflags:domhier /update<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->net stop w32time <!-- raw HTML omitted -->
<!-- raw HTML omitted -->net start w32time<!-- raw HTML omitted --></p>
<p>Then I re-ran the activation command</p>
<p><!-- raw HTML omitted -->cscript slmgr.vbs /ato<!-- raw HTML omitted --></p>
<p>and bosh&hellip;all activated&hellip;&hellip;..and DNS registered fine too&hellip;&hellip;&hellip;..and everything &ldquo;just worked&rdquo;</p>
<p><!-- raw HTML omitted -->What have &ldquo;we&rdquo; learned?<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>List of Windows Product keys for use with slmgr.vbs if your server/desktop loses it&rsquo;s product key.
<!-- raw HTML omitted --><a href="http://technet.microsoft.com/en-us/library/ff793421.aspx">http://technet.microsoft.com/en-us/library/ff793421.aspx</a><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
